import"./modulepreload-polyfill-B5Qt9EMX.js";const $=()=>{const t=new Set;return{subscribe:c=>t.add(c),notify:()=>t.forEach(c=>{typeof c=="function"&&c()})}},g=(t,e)=>{const{subscribe:r,notify:c}=$();let a={...t};const u=s=>{a={...a,...s},c()},o=()=>({...a}),i={};for(const s in e)i[s]=(...n)=>{const d=e[s],l=d(o(),...n);u(l)};return{getState:o,subscribe:r,actions:i}},b=g({items:[]},{increaseCartItem(t,e){const r=t.items.find(a=>a.id===e.id);let c;return r?c=t.items.map(a=>a.id===e.id?{...a,quantity:a.quantity+1}:a):c=[...t.items,{...e,quantity:1}],{items:c}},decreaseCartItem(t,e){const r=t.items.find(a=>a.id===e);let c;return r?(r.quantity>1?c=t.items.map(a=>a.id===e?{...a,quantity:a.quantity-1}:a):c=t.items.filter(a=>a.id!==e),{items:c}):(alert("아이템의 수량을 줄이는데 오류가 발생했습니다."),{...t})},deleteFromCart(t,e){return t.items.find(a=>a.id===e)?{items:t.items.filter(a=>a.id!==e)}:(alert("아이템을 장바구니에서 제거하는데 오류가 발생했습니다."),{...t})}});function h(){return{...b.getState(),...b.actions}}const I=g({products:[{id:"p1",name:"상품1",price:1e4,quantity:50,discountRate:.1},{id:"p2",name:"상품2",price:2e4,quantity:30,discountRate:.15},{id:"p3",name:"상품3",price:3e4,quantity:20,discountRate:.2},{id:"p4",name:"상품4",price:15e3,quantity:0,discountRate:.05},{id:"p5",name:"상품5",price:25e3,quantity:10,discountRate:.25}],lastSelectedProductId:null},{updateProduct(t,e,r){const c=t.products.map(a=>a.id===e?{...a,...r}:a);return{...t,products:c}},updateLastSelectedProductId(t,e){return{...t,lastSelectedProductId:e}}});function p(){return{...I.getState(),...I.actions}}const C=new Map,v=t=>{const e=C.get(t.type);if(e)for(const[r,c]of e){const a=t.target;if(r.contains(a)){c(t);break}}};function w(t){for(const[e]of C)t.addEventListener(e,v)}function S(t,e,r){C.has(e)||C.set(e,new Map);const c=C.get(e);c&&c.set(t,r)}function P(){const t=document.createElement("div");t.id="cart-items";const e=(a,u,o)=>{const{updateProduct:i}=p(),{increaseCartItem:s,decreaseCartItem:n,deleteFromCart:d}=h(),l=o.id;(u==null?void 0:u.quantity)+a<=0?(d(o.id),i(o.id,{quantity:o.quantity-a})):a<=o.quantity?(a===1?s({id:l,name:o.name,price:o.price}):n(l),i(l,{quantity:o.quantity-a})):alert("재고가 부족합니다.")};S(t,"click",a=>{const{products:u,updateProduct:o}=p(),{items:i,deleteFromCart:s}=h(),n=a.target;if(n.classList.contains("quantity-change")||n.classList.contains("remove-item")){const d=n.dataset.productId,l=u.find(m=>m.id===d),f=i.find(m=>m.id===d);if(!f||!l){alert("상품이 잘못 선택 되었습니다.");return}if(n.classList.contains("quantity-change")){const m=parseInt(n.dataset.change);e(m,f,l)}else if(n.classList.contains("remove-item")){const m=document.getElementById(d);m==null||m.remove(),s(d),o(d,{quantity:l.quantity+f.quantity})}}});const c=()=>{const{items:a}=h();a.forEach(u=>{let o=document.getElementById(u.id);if(o){const i=document.querySelector(`#${u.id} span`);i&&(i.textContent=`${u.name} - ${u.price}원 x ${u.quantity}`)}else o=document.createElement("div"),o.id=u.id,o.className="flex justify-between items-center mb-2",o.innerHTML=`<span> ${u.name} - ${u.price}원 x ${u.quantity}</span><div><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${u.id}" data-change="-1">-</button><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${u.id}" data-change="1">+</button><button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${u.id}">삭제</button></div>`,t.appendChild(o)})};return b.subscribe(c),c(),t}function T({id:t,className:e,options:r}){const c=document.createElement("select");return c.id=t,c.className=e,(()=>{c.innerHTML=`
      ${r.map(({id:u,value:o,content:i,disabled:s})=>`<option id=${u} value=${o} ${s&&"disabled"}>${i}</option>`).join("")}
    `})(),c}function L(){const t=document.createDocumentFragment(),e=document.createElement("button");e.id="add-to-cart",e.className="bg-blue-500 text-white px-4 py-2 rounded",e.textContent="추가",t.appendChild(e);let r=!0;const c=(i,s)=>{const{increaseCartItem:n}=h(),{updateProduct:d}=p();i.quantity+1<=s.quantity?(n({id:s.id,name:s.name,price:s.price}),d(s.id,{quantity:s.quantity-1})):alert("재고가 부족합니다.")},a=i=>{const{updateProduct:s}=p(),{increaseCartItem:n}=h();n({id:i.id,name:i.name,price:i.price}),s(i.id,{quantity:i.quantity-1})};S(e,"click",()=>{var m;const{products:i,updateLastSelectedProductId:s}=p(),{items:n}=h(),d=(m=document.getElementById("product-select"))==null?void 0:m.value,l=i.find(y=>y.id===d);if(!l){alert("상품이 잘못 선택 되었습니다.");return}if(l.quantity<=0){alert("재고가 부족합니다");return}const f=n.find(y=>y.id===d);f?c(f,l):a(l),s(d)});const o=()=>{const{products:i}=p(),s=i.map(n=>({id:`product-select-option-${n.id}`,value:n.id,content:`${n.name} - ${n.price}원`,disabled:n.quantity===0}));r?(t.prepend(T({id:"product-select",className:"border rounded p-2 mr-2",options:s})),r=!1):i.forEach(n=>{const d=document.getElementById(`product-select-option-${n.id}`);d&&(d.textContent=`${n.name} - ${n.price}원`)})};return I.subscribe(o),o(),t}function M(){const t=document.createElement("div");t.id="cart-total",t.className="text-xl font-bold my-4";const e=30,r=.25,c=.1,a=()=>{const{items:i}=h(),{products:s}=p();let n=0,d=0,l=0;return i.forEach(({id:f,quantity:m})=>{const y=s.find(E=>E.id===f);if(!y)return;const q=y.price*m,x=m>=10?y.discountRate:0;d+=m,n+=q,l+=q*(1-x)}),{totalPrice:n,totalCount:d,totalDiscountedPrice:l}},u=(i,s,n)=>{const d=s-n;let l=(s-n)/s;return i>=e&&n*r>d&&(n=n=s*(1-r),l=r),new Date().getDay()===2&&(n*=1-c,l=Math.max(l,c)),l},o=()=>{const{totalPrice:i,totalCount:s,totalDiscountedPrice:n}=a(),d=u(s,i,n);t.innerHTML=`총액: ${n}원${d>0?`<span class="text-green-500 ml-2">(${(d*100).toFixed(1)}% 할인 적용)</span>`:""}<span id="bonus-points" class="text-blue-500 ml-2">(포인트: ${Math.floor(n/1e3)})</span>`};return b.subscribe(o),o(),t}function R(){const t=document.createElement("div");t.id="stock-status",t.className="text-sm text-gray-500 mt-2";const e=()=>{const{products:r}=p();t.innerHTML=`
      ${r.map(c=>{if(c.quantity<5)return`${c.name}: ${c.quantity>0?"재고 부족 ("+c.quantity+"개 남음)":"품절"}
`}).join("")}
    `};return I.subscribe(e),e(),t}function N(){const t=document.createElement("div");t.id="wrapper",t.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8";const e=.8,r=.95,c=()=>{const{products:o,updateProduct:i}=p();setInterval(()=>{const s=o[Math.floor(Math.random()*o.length)];s.quantity>0&&(alert(`번개세일! ${s.name}이(가) 20% 할인 중입니다!`),i(s.id,{price:Math.round(s.price*e)}))},1e4)},a=()=>{const{products:o,lastSelectedProductId:i,updateProduct:s}=p();setInterval(()=>{if(!i)return;const n=o.find(d=>d.id!==i&&d.quantity>0);n&&(n.price=Math.round(n.price*r),alert(`${n.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`),s(n.id,{price:Math.round(Math.round(n.price*r))}))},6e4)};return(()=>{t.innerHTML=`
      <h1 class="text-2xl font-bold mb-4">장바구니</h1>
    `,t.appendChild(P()),t.appendChild(M()),t.appendChild(L()),t.appendChild(R())})(),c(),a(),t}function k(){(()=>{const e=document.getElementById("app"),r=document.createElement("div");r.id="container",r.appendChild(N()),e.appendChild(r),w(e)})()}const _=()=>{k()};_();
